<!DOCTYPE html>
<html lang="vi" class="js csstransforms3d">
  <head><script src="/awsDeployment/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=awsDeployment/livereload" data-no-instant defer></script>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="Hugo 0.134.3">
    <meta name="description" content="To deploy a web application that interacts with RDS and S3, you need to configure an IAM Role that grants permissions for these services">
<meta name="author" content="phivt1234@gmail.com">

    <link rel="icon" href="http://localhost:1313/awsDeployment/images/favicon.png" type="image/png">

    <title>Tổng hợp dữ liệu :: AWS System Manager</title>

    
    <link href="http://localhost:1313/awsDeployment/css/nucleus.css?1752224769" rel="stylesheet">
    <link href="http://localhost:1313/awsDeployment/css/fontawesome-all.min.css?1752224769" rel="stylesheet">
    <link href="http://localhost:1313/awsDeployment/css/hybrid.css?1752224769" rel="stylesheet">
    <link href="http://localhost:1313/awsDeployment/css/featherlight.min.css?1752224769" rel="stylesheet">
    <link href="http://localhost:1313/awsDeployment/css/perfect-scrollbar.min.css?1752224769" rel="stylesheet">
    <link href="http://localhost:1313/awsDeployment/css/auto-complete.css?1752224769" rel="stylesheet">
    <link href="http://localhost:1313/awsDeployment/css/atom-one-dark-reasonable.css?1752224769" rel="stylesheet">
    <link href="http://localhost:1313/awsDeployment/css/theme.css?1752224769" rel="stylesheet">
    <link href="http://localhost:1313/awsDeployment/css/hugo-theme.css?1752224769" rel="stylesheet">
    
    <link href="http://localhost:1313/awsDeployment/css/theme-workshop.css?1752224769" rel="stylesheet">
    
    

    <script src="http://localhost:1313/awsDeployment/js/jquery-3.3.1.min.js?1752224769"></script>

    <style>
      :root #header + #content > #left > #rlblock_left{
          display:none !important;
      }
      
    </style>
    
  </head>
  <body class="" data-url="http://localhost:1313/awsDeployment/vi/3-setting-up-environment-ec2-s3-docker/3.2-create-rds/">
    <nav id="sidebar" class="showVisitedLinks">



  <div id="header-wrapper">
    <div id="header">
      <a id="logo" href="http://localhost:1313/awsDeployment/">

<svg id="Layer_1" data-name="Layer 1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 60 30" width="30%"><defs><style>.cls-1{fill:#fff;}.cls-2{fill:#f90;fill-rule:evenodd;}</style></defs><title>AWS-Logo_White-Color</title><path class="cls-1" d="M14.09,10.85a4.7,4.7,0,0,0,.19,1.48,7.73,7.73,0,0,0,.54,1.19.77.77,0,0,1,.12.38.64.64,0,0,1-.32.49l-1,.7a.83.83,0,0,1-.44.15.69.69,0,0,1-.49-.23,3.8,3.8,0,0,1-.6-.77q-.25-.42-.51-1a6.14,6.14,0,0,1-4.89,2.3,4.54,4.54,0,0,1-3.32-1.19,4.27,4.27,0,0,1-1.22-3.2A4.28,4.28,0,0,1,3.61,7.75,6.06,6.06,0,0,1,7.69,6.46a12.47,12.47,0,0,1,1.76.13q.92.13,1.91.36V5.73a3.65,3.65,0,0,0-.79-2.66A3.81,3.81,0,0,0,7.86,2.3a7.71,7.71,0,0,0-1.79.22,12.78,12.78,0,0,0-1.79.57,4.55,4.55,0,0,1-.58.22l-.26,0q-.35,0-.35-.52V2a1.09,1.09,0,0,1,.12-.58,1.2,1.2,0,0,1,.47-.35A10.88,10.88,0,0,1,5.77.32,10.19,10.19,0,0,1,8.36,0a6,6,0,0,1,4.35,1.35,5.49,5.49,0,0,1,1.38,4.09ZM7.34,13.38a5.36,5.36,0,0,0,1.72-.31A3.63,3.63,0,0,0,10.63,12,2.62,2.62,0,0,0,11.19,11a5.63,5.63,0,0,0,.16-1.44v-.7a14.35,14.35,0,0,0-1.53-.28,12.37,12.37,0,0,0-1.56-.1,3.84,3.84,0,0,0-2.47.67A2.34,2.34,0,0,0,5,11a2.35,2.35,0,0,0,.61,1.76A2.4,2.4,0,0,0,7.34,13.38Zm13.35,1.8a1,1,0,0,1-.64-.16,1.3,1.3,0,0,1-.35-.65L15.81,1.51a3,3,0,0,1-.15-.67.36.36,0,0,1,.41-.41H17.7a1,1,0,0,1,.65.16,1.4,1.4,0,0,1,.33.65l2.79,11,2.59-11A1.17,1.17,0,0,1,24.39.6a1.1,1.1,0,0,1,.67-.16H26.4a1.1,1.1,0,0,1,.67.16,1.17,1.17,0,0,1,.32.65L30,12.39,32.88,1.25A1.39,1.39,0,0,1,33.22.6a1,1,0,0,1,.65-.16h1.54a.36.36,0,0,1,.41.41,1.36,1.36,0,0,1,0,.26,3.64,3.64,0,0,1-.12.41l-4,12.86a1.3,1.3,0,0,1-.35.65,1,1,0,0,1-.64.16H29.25a1,1,0,0,1-.67-.17,1.26,1.26,0,0,1-.32-.67L25.67,3.64,23.11,14.34a1.26,1.26,0,0,1-.32.67,1,1,0,0,1-.67.17Zm21.36.44a11.28,11.28,0,0,1-2.56-.29,7.44,7.44,0,0,1-1.92-.67,1,1,0,0,1-.61-.93v-.84q0-.52.38-.52a.9.9,0,0,1,.31.06l.42.17a8.77,8.77,0,0,0,1.83.58,9.78,9.78,0,0,0,2,.2,4.48,4.48,0,0,0,2.43-.55,1.76,1.76,0,0,0,.86-1.57,1.61,1.61,0,0,0-.45-1.16A4.29,4.29,0,0,0,43,9.22l-2.41-.76A5.15,5.15,0,0,1,38,6.78a3.94,3.94,0,0,1-.83-2.41,3.7,3.7,0,0,1,.45-1.85,4.47,4.47,0,0,1,1.19-1.37A5.27,5.27,0,0,1,40.51.29,7.4,7.4,0,0,1,42.6,0a8.87,8.87,0,0,1,1.12.07q.57.07,1.08.19t.95.26a4.27,4.27,0,0,1,.7.29,1.59,1.59,0,0,1,.49.41.94.94,0,0,1,.15.55v.79q0,.52-.38.52a1.76,1.76,0,0,1-.64-.2,7.74,7.74,0,0,0-3.2-.64,4.37,4.37,0,0,0-2.21.47,1.6,1.6,0,0,0-.79,1.48,1.58,1.58,0,0,0,.49,1.18,4.94,4.94,0,0,0,1.83.92L44.55,7a5.08,5.08,0,0,1,2.57,1.6A3.76,3.76,0,0,1,47.9,11a4.21,4.21,0,0,1-.44,1.93,4.4,4.4,0,0,1-1.21,1.47,5.43,5.43,0,0,1-1.85.93A8.25,8.25,0,0,1,42.05,15.62Z"></path><path class="cls-2" d="M45.19,23.81C39.72,27.85,31.78,30,25,30A36.64,36.64,0,0,1,.22,20.57c-.51-.46-.06-1.09.56-.74A49.78,49.78,0,0,0,25.53,26.4,49.23,49.23,0,0,0,44.4,22.53C45.32,22.14,46.1,23.14,45.19,23.81Z"></path><path class="cls-2" d="M47.47,21.21c-.7-.9-4.63-.42-6.39-.21-.53.06-.62-.4-.14-.74,3.13-2.2,8.27-1.57,8.86-.83s-.16,5.89-3.09,8.35c-.45.38-.88.18-.68-.32C46.69,25.8,48.17,22.11,47.47,21.21Z"></path></svg>

</a>

    </div>
    
        <div class="searchbox">
    <label for="search-by"><i class="fas fa-search"></i></label>
    <input data-search-input id="search-by" type="search" placeholder="Search...">
    <span data-search-clear=""><i class="fas fa-times"></i></span>
</div>

<script type="text/javascript" src="http://localhost:1313/awsDeployment/js/lunr.min.js?1752224769"></script>
<script type="text/javascript" src="http://localhost:1313/awsDeployment/js/auto-complete.js?1752224769"></script>
<script type="text/javascript">
    
        var baseurl = "http:\/\/localhost:1313\/awsDeployment\/\/vi";
    
</script>
<script type="text/javascript" src="http://localhost:1313/awsDeployment/js/search.js?1752224769"></script>

    
  </div>

    <div class="highlightable">
    <ul class="topics">

        
          
          




 
  
    
    <li data-nav-id="/vi/1-introduce/" title="Giới thiệu" class="dd-item 
        
        
        
        ">
      <a href="http://localhost:1313/awsDeployment/vi/1-introduce/">
           <b> 1. </b> Giới thiệu
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/vi/2-prerequiste/" title="Chuẩn Bị" class="dd-item 
        
        
        
        ">
      <a href="http://localhost:1313/awsDeployment/vi/2-prerequiste/">
           <b> 2. </b> Chuẩn Bị
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
            
          
          
          
        
          
            
            




 
  
    
    <li data-nav-id="/vi/2-prerequiste/2.1-create-iam-role/" title="Tạo IAM Role cho AWS Lambda" class="dd-item 
        
        
        
        ">
      <a href="http://localhost:1313/awsDeployment/vi/2-prerequiste/2.1-create-iam-role/">
           <b> 2.1. </b> Tạo IAM Role cho AWS Lambda
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/vi/2-prerequiste/2.2-create-dynamo/" title="Tạo DynamoDB Table và Bật DynamoDB Stream" class="dd-item 
        
        
        
        ">
      <a href="http://localhost:1313/awsDeployment/vi/2-prerequiste/2.2-create-dynamo/">
           <b> 2.2. </b> Tạo DynamoDB Table và Bật DynamoDB Stream
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/vi/2-prerequiste/2.3-create-lambda/" title="Tạo Lambda và gắn với DynamoDB Stream" class="dd-item 
        
        
        
        ">
      <a href="http://localhost:1313/awsDeployment/vi/2-prerequiste/2.3-create-lambda/">
           <b> 2.3. </b> Tạo Lambda và gắn với DynamoDB Stream
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/vi/3-setting-up-environment-ec2-s3-docker/" title="Biến Đổi Logic" class="dd-item 
        parent
        
        
        ">
      <a href="http://localhost:1313/awsDeployment/vi/3-setting-up-environment-ec2-s3-docker/">
           <b> 3. </b> Biến Đổi Logic
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
            
          
          
          
        
          
            
            




 
  
    
    <li data-nav-id="/vi/3-setting-up-environment-ec2-s3-docker/3.1-create-s3-uploadimage/" title="Xử lý dữ liệu trong Lambda " class="dd-item 
        
        
        
        ">
      <a href="http://localhost:1313/awsDeployment/vi/3-setting-up-environment-ec2-s3-docker/3.1-create-s3-uploadimage/">
           <b> 3.1. </b> Xử lý dữ liệu trong Lambda 
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/vi/3-setting-up-environment-ec2-s3-docker/3.2-create-rds/" title="Tổng hợp dữ liệu" class="dd-item 
        
        active
        
        ">
      <a href="http://localhost:1313/awsDeployment/vi/3-setting-up-environment-ec2-s3-docker/3.2-create-rds/">
           <b> 3.2 </b> Tổng hợp dữ liệu
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/vi/4-error-handling/" title="Xử lý l" class="dd-item 
        
        
        
        ">
      <a href="http://localhost:1313/awsDeployment/vi/4-error-handling/">
           <b> 4. </b> Xử lý l
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
            
          
          
          
        
          
            
            




 
  
    
    <li data-nav-id="/vi/4-error-handling/4.1-prerequiste-deployment-ec2/" title="các buớc chuẩn bị cho triển khai in ec2" class="dd-item 
        
        
        
        ">
      <a href="http://localhost:1313/awsDeployment/vi/4-error-handling/4.1-prerequiste-deployment-ec2/">
           <b> 4.1 </b> các buớc chuẩn bị cho triển khai in ec2
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/vi/4-error-handling/4.2-setup-dockerhub-in-ec2/" title="Thiết lập dockerhub trong ec2" class="dd-item 
        
        
        
        ">
      <a href="http://localhost:1313/awsDeployment/vi/4-error-handling/4.2-setup-dockerhub-in-ec2/">
           <b> 4.2 </b> Thiết lập dockerhub trong ec2
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/vi/5-deployment-and-testing-in-ec2/" title="triển khai và kiểm thử ứng dụng springboot trên ec2" class="dd-item 
        
        
        
        ">
      <a href="http://localhost:1313/awsDeployment/vi/5-deployment-and-testing-in-ec2/">
           <b> 5. </b> triển khai và kiểm thử ứng dụng springboot trên ec2
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/vi/6-cleanup/" title="Dọn dẹp tài nguyên" class="dd-item 
        
        
        
        ">
      <a href="http://localhost:1313/awsDeployment/vi/6-cleanup/">
          <b>6. </b>Dọn dẹp tài nguyên
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

          
         
    </ul>

    
    
      <section id="shortcuts">
        <h3>More</h3>
        <ul>
          
              <li> 
                  <a class="padding" href="https://www.facebook.com/groups/awsstudygroupfcj/"><i class='fab fa-facebook'></i> AWS Study Group</a>
              </li>
          
        </ul>
      </section>
    

    
    <section id="prefooter">
      <hr/>
      <ul>
      
        <li>
          <a class="padding">
            <i class="fas fa-language fa-fw"></i>
          <div class="select-style">
            <select id="select-language" onchange="location = this.value;">
          
          
          
              
              
                  
                    
                    
                      <option id="en" value="http://localhost:1313/awsDeployment/3-setting-up-environment-ec2-s3-docker/3.2-create-rds/">English</option>
                    
                  
              
                  
              
          
              
              
                  
              
                  
                    
                    
                      <option id="vi" value="http://localhost:1313/awsDeployment/vi/3-setting-up-environment-ec2-s3-docker/3.2-create-rds/" selected>Tiếng Việt</option>
                    
                  
              
          
        </select>
        <svg version="1.1" id="Capa_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
          width="255px" height="255px" viewBox="0 0 255 255" style="enable-background:new 0 0 255 255;" xml:space="preserve">
          <g>
            <g id="arrow-drop-down">
              <polygon points="0,63.75 127.5,191.25 255,63.75 		" />
            </g>
          </g>
        </svg>
        </div>
        </a>
        </li>
      
      
      
        <li><a class="padding" href="#" data-clear-history-toggle=""><i class="fas fa-history fa-fw"></i> Clear History</a></li>
      
      </ul>
    </section>
    
    <section id="footer">
      <left>
    
    <b> Workshop</b> <br>
    <img src="https://hitwebcounter.com/counter/counter.php?page=7920860&style=0038&nbdigits=9&type=page&initCount=0"
        title="Migrate" Alt="web counter" border="0" /></a> <br>
    <b> <a href="https://cloudjourney.awsstudygroup.com/">Cloud Journey</a></b> <br>
    <img src="https://hitwebcounter.com/counter/counter.php?page=7830807&style=0038&nbdigits=9&type=page&initCount=0"
        title="Total CLoud Journey" Alt="web counter" border="0" />

</left>
<left>
    <br>
    <br>
    <b> Last Updated </b> <br>
    <i>
        <font color=orange>30-01-2022</font>
    </i>
</left>
<left>
    <br>
    <br>
    <b> Team </b> <br>

    <i> <a href="" style="color:orange">Nhật Phi </a> <br>

    </i>
</left>

<script async defer src="https://buttons.github.io/buttons.js"></script>
    </section>
  </div>
</nav>




        <section id="body">
        <div id="overlay"></div>
        <div class="padding highlightable">
              
              <div>
                <div id="top-bar">
                
                
                <div id="breadcrumbs" itemscope="" itemtype="http://data-vocabulary.org/Breadcrumb">
                    <span id="sidebar-toggle-span">
                        <a href="#" id="sidebar-toggle" data-sidebar-toggle="">
                          <i class="fas fa-bars"></i>
                        </a>
                    </span>
                  
                  <span id="toc-menu"><i class="fas fa-list-alt"></i></span>
                  
                  <span class="links">
                 
                 
                    
          
          
            
            
          
          
            
            
          
          
            <a href='http://localhost:1313/awsDeployment/vi/'>Session Management</a> > <a href='http://localhost:1313/awsDeployment/vi/3-setting-up-environment-ec2-s3-docker/'>Biến Đổi Logic</a> > Tổng hợp dữ liệu
          
        
          
        
          
        
                 
                  </span>
                </div>
                
                    <div class="progress">
    <div class="wrapper">
<nav id="TableOfContents"></nav>
    </div>
</div>

                
              </div>
            </div>
            
        <div id="head-tags">
        
        </div>
        
        <div id="body-inner">
          
            <h1>
              
              Tổng hợp dữ liệu
            </h1>
          

        



	<p>Trong các hệ thống xử lý dữ liệu thời gian thực, việc chỉ ghi nhận từng sự kiện riêng lẻ là chưa đủ. Một yêu cầu phổ biến trong thực tế là cần phải tổng hợp dữ liệu nhằm cung cấp thông tin mang tính khái quát, hỗ trợ cho việc phân tích và ra quyết định nhanh chóng.</p>
<p>Với đề tài này, mỗi khi có một đơn hàng mới được ghi nhận vào bảng OrdersTable, hệ thống không chỉ xử lý sự kiện đó mà còn cập nhật tổng số lượng của từng sản phẩm đã được đặt. Điều này mang lại cái nhìn trực quan hơn về xu hướng tiêu dùng theo thời gian thực mà không cần chạy batch job vào cuối ngày như các hệ thống truyền thống.</p>
<p>Để hiện thực điều này, ta triển khai thuật toán tổng hợp ngay bên trong hàm Lambda bằng cách sử dụng DynamoDB UpdateItem với biểu thức ADD, đảm bảo hiệu năng và tính nhất quán cao. Mọi thay đổi đều được ghi nhận tức thì, phù hợp với đặc trưng của các hệ thống serverless event-driven hiện đại.</p>
<ol>
<li>
<p>Tạo bảng tổng hợp mới <a href="https://ap-southeast-1.console.aws.amazon.com/dynamodbv2/home?region=ap-southeast-1#tables">Tạo bảng</a>.</p>
<ul>
<li>Truy cập DynamoDB &gt; Tables &gt; Create Table</li>
</ul>
</li>
</ol>
<p><img alt="Create" src="http://localhost:1313/awsDeployment/images/3.s3/Lambda3.2.1.png"></p>
<ul>
<li>
<p>Nhập thông tin:</p>
<ul>
<li>
<p>Table name: AggregateTable</p>
</li>
<li>
<p>Partition key: product (kiểu String)</p>
</li>
<li>
<p>Bấm Create Table</p>
</li>
</ul>
</li>
</ul>
<ol start="2">
<li>Cập nhật Lambda để ghi dữ liệu vào bảng
<ul>
<li>Mở lại hàm Lambda đã xử lý stream.</li>
<li>Thêm quyền ghi vào AggregateTable:
<ul>
<li>Vào Configuration &gt; Permissions &gt; Rolename (VD: <strong>LambdaDynamoDBStreamRole</strong>)</li>
</ul>
</li>
</ul>
</li>
</ol>
<p><img alt="Create S3" src="http://localhost:1313/awsDeployment/images/3.s3/Lambda3.2.2.png"></p>
<ul>
<li>Trong trang IAM Role, chọn Add permissions &gt; Attach policies</li>
</ul>
<p><img alt="Create S3" src="http://localhost:1313/awsDeployment/images/3.s3/Lambda3.2.3.png"></p>
<ul>
<li>
<p>Gán quyền AmazonDynamoDBFullAccess (hoặc custom policy chỉ cho phép PutItem, UpdateItem trên bảng AggregateTable)</p>
</li>
<li>
<p>Sau đó quay lại Lambda functions cập nhật lại đoạn code như sau:</p>
</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>import <span style="color:#f92672">{</span> DynamoDBClient, UpdateItemCommand <span style="color:#f92672">}</span> from <span style="color:#e6db74">&#34;@aws-sdk/client-dynamodb&#34;</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>const client <span style="color:#f92672">=</span> new DynamoDBClient<span style="color:#f92672">({})</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>export const handler <span style="color:#f92672">=</span> async <span style="color:#f92672">(</span>event<span style="color:#f92672">)</span> <span style="color:#f92672">=</span>&gt; <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> <span style="color:#f92672">(</span>const record of event.Records<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span> console.log<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;📥 Event Name:&#34;</span>, record.eventName<span style="color:#f92672">)</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span> const newImage <span style="color:#f92672">=</span> record.dynamodb?.NewImage;
</span></span><span style="display:flex;"><span> <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>!newImage<span style="color:#f92672">)</span> <span style="color:#66d9ef">continue</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span> const orderId <span style="color:#f92672">=</span> newImage.OrderID?.S <span style="color:#f92672">||</span> <span style="color:#e6db74">&#34;unknown&#34;</span>;
</span></span><span style="display:flex;"><span> const product <span style="color:#f92672">=</span> newImage.Product?.S <span style="color:#f92672">||</span> <span style="color:#e6db74">&#34;unknown&#34;</span>;
</span></span><span style="display:flex;"><span> const quantity <span style="color:#f92672">=</span> parseInt<span style="color:#f92672">(</span>newImage.Quantity?.N <span style="color:#f92672">||</span> <span style="color:#e6db74">&#34;0&#34;</span><span style="color:#f92672">)</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span> console.log<span style="color:#f92672">(</span><span style="color:#e6db74">`</span>🛒 New Order Received - ID: <span style="color:#e6db74">${</span>orderId<span style="color:#e6db74">}</span>, Product: <span style="color:#e6db74">${</span>product<span style="color:#e6db74">}</span>, Quantity: <span style="color:#e6db74">${</span>quantity<span style="color:#e6db74">}</span><span style="color:#e6db74">`</span><span style="color:#f92672">)</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span> const transformedOrder <span style="color:#f92672">=</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>   orderId,
</span></span><span style="display:flex;"><span>   product,
</span></span><span style="display:flex;"><span>   quantity
</span></span><span style="display:flex;"><span> <span style="color:#f92672">}</span>;
</span></span><span style="display:flex;"><span> console.log<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;🔁 Transformed Order:&#34;</span>, transformedOrder<span style="color:#f92672">)</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span> const params <span style="color:#f92672">=</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>   TableName: <span style="color:#e6db74">&#34;AggregateTable&#34;</span>,
</span></span><span style="display:flex;"><span>   Key: <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>     Product: <span style="color:#f92672">{</span> S: product <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>   <span style="color:#f92672">}</span>,
</span></span><span style="display:flex;"><span>   UpdateExpression: <span style="color:#e6db74">&#34;SET totalQuantity = if_not_exists(totalQuantity, :zero) + :qty&#34;</span>,
</span></span><span style="display:flex;"><span>   ExpressionAttributeValues: <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>     <span style="color:#e6db74">&#34;:qty&#34;</span>: <span style="color:#f92672">{</span> N: quantity.toString<span style="color:#f92672">()</span> <span style="color:#f92672">}</span>,
</span></span><span style="display:flex;"><span>     <span style="color:#e6db74">&#34;:zero&#34;</span>: <span style="color:#f92672">{</span> N: <span style="color:#e6db74">&#34;0&#34;</span> <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>   <span style="color:#f92672">}</span>,
</span></span><span style="display:flex;"><span>   ReturnValues: <span style="color:#e6db74">&#34;UPDATED_NEW&#34;</span>
</span></span><span style="display:flex;"><span> <span style="color:#f92672">}</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span> try <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>   const result <span style="color:#f92672">=</span> await client.send<span style="color:#f92672">(</span>new UpdateItemCommand<span style="color:#f92672">(</span>params<span style="color:#f92672">))</span>;
</span></span><span style="display:flex;"><span>   const newTotal <span style="color:#f92672">=</span> result.Attributes?.totalQuantity?.N;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>   console.log<span style="color:#f92672">(</span><span style="color:#e6db74">`</span>📊 Tổng số lượng sau cộng dồn: <span style="color:#e6db74">${</span>newTotal<span style="color:#e6db74">}</span><span style="color:#e6db74">`</span><span style="color:#f92672">)</span>;
</span></span><span style="display:flex;"><span>   console.log<span style="color:#f92672">(</span><span style="color:#e6db74">`</span>✅ Cộng dồn thành công vào AggregateTable cho sản phẩm <span style="color:#e6db74">${</span>product<span style="color:#e6db74">}</span><span style="color:#e6db74">`</span><span style="color:#f92672">)</span>;
</span></span><span style="display:flex;"><span> <span style="color:#f92672">}</span> catch <span style="color:#f92672">(</span>err<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>   console.error<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;❌ Lỗi khi cập nhật AggregateTable:&#34;</span>, err<span style="color:#f92672">)</span>;
</span></span><span style="display:flex;"><span> <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">return</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span> statusCode: 200,
</span></span><span style="display:flex;"><span> body: <span style="color:#e6db74">&#34;OK&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>;
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>;
</span></span></code></pre></div><p><img alt="Create S3" src="http://localhost:1313/awsDeployment/images/3.s3/Lambda3.2.5.png"></p>
<ol start="3">
<li>Kiểm tra hoạt động
<ul>
<li>
<p>Vào OrdersTable &gt; Items &gt; Create Item</p>
</li>
<li>
<p>Tạo item mới với OrderID, Product, Quantity</p>
</li>
</ul>
</li>
</ol>
<p><img alt="Create S3" src="http://localhost:1313/awsDeployment/images/3.s3/Lambda3.2.6.png"></p>
<ul>
<li>Chọn <strong>JSON view</strong></li>
</ul>
<pre tabindex="0"><code>{
&#34;OrderID&#34;: {
 &#34;S&#34;: &#34;order-1&#34;
},
&#34;Product&#34;: {
 &#34;S&#34;: &#34;Notebook&#34;
},
&#34;Quantity&#34;: {
 &#34;N&#34;: &#34;5&#34;
}
}
</code></pre><p><img alt="Create S3" src="http://localhost:1313/awsDeployment/images/3.s3/Lambda3.2.7.png"></p>
<p><img alt="Create S3" src="http://localhost:1313/awsDeployment/images/3.s3/Lambda3.2.8.png"></p>
<ul>
<li>Chờ 1-2s → Mở AggregateTable, chọn Scan &gt; Run</li>
</ul>
<p><img alt="Create S3" src="http://localhost:1313/awsDeployment/images/3.s3/Lambda3.2.9.png"></p>
<ul>
<li>Kiểm tra cột totalQuantity đã được cập nhật chính xác theo Product</li>
</ul>
<p><img alt="Create S3" src="http://localhost:1313/awsDeployment/images/3.s3/Lambda3.2.10.png"></p>





<footer class=" footline" >
	
</footer>

        
        </div> 
        

      </div>

    <div id="navigation">
        
        
        
        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
        
        


	 
	 
		
			<a class="nav nav-prev" href="http://localhost:1313/awsDeployment/vi/3-setting-up-environment-ec2-s3-docker/3.1-create-s3-uploadimage/" title="Xử lý dữ liệu trong Lambda "> <i class="fa fa-chevron-left"></i></a>
		
		
			<a class="nav nav-next" href="http://localhost:1313/awsDeployment/vi/4-error-handling/" title="Xử lý l" style="margin-right: 0px;"><i class="fa fa-chevron-right"></i></a>
		
	
    </div>

    </section>
    
    <div style="left: -1000px; overflow: scroll; position: absolute; top: -1000px; border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;">
      <div style="border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;"></div>
    </div>
    <script src="http://localhost:1313/awsDeployment/js/clipboard.min.js?1752224769"></script>
    <script src="http://localhost:1313/awsDeployment/js/perfect-scrollbar.min.js?1752224769"></script>
    <script src="http://localhost:1313/awsDeployment/js/perfect-scrollbar.jquery.min.js?1752224769"></script>
    <script src="http://localhost:1313/awsDeployment/js/jquery.sticky.js?1752224769"></script>
    <script src="http://localhost:1313/awsDeployment/js/featherlight.min.js?1752224769"></script>
    <script src="http://localhost:1313/awsDeployment/js/highlight.pack.js?1752224769"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <script src="http://localhost:1313/awsDeployment/js/modernizr.custom-3.6.0.js?1752224769"></script>
    <script src="http://localhost:1313/awsDeployment/js/learn.js?1752224769"></script>
    <script src="http://localhost:1313/awsDeployment/js/hugo-learn.js?1752224769"></script>

    <link href="http://localhost:1313/awsDeployment/mermaid/mermaid.css?1752224769" rel="stylesheet" />
    <script src="http://localhost:1313/awsDeployment/mermaid/mermaid.js?1752224769"></script>
    <script>
        mermaid.initialize({ startOnLoad: true });
    </script>
    <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-158079754-2', 'auto');
  ga('send', 'pageview');

</script>
  </body>
</html>
